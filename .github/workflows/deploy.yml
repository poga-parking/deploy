name: Deploy Repository

on: [push] # Или другое событие по вашему выбору

env:
  SOURCE_CODE_PATH: poga-deploy

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Copy Repository to Remote Server
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.DEPLOY_REMOTE_HOST }}
        username: ${{ secrets.DEPLOY_REMOTE_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        rm: true
        source: "."
        target: "${{ env.SOURCE_CODE_PATH }}"
        
    - name: Export token 
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DEPLOY_REMOTE_HOST }}
        username: ${{ secrets.DEPLOY_REMOTE_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
            export TELEGRAM_BOT_TOKEN="${{ secrets.TELEGRAM_BOT_TOKEN }}"
            cd ${{ env.SOURCE_CODE_PATH }}/configs/monitoring/alertmanager
            sed -i "s|bot_token: ''|bot_token: '${TELEGRAM_BOT_TOKEN}'|g" alertmanager-config.yml
            echo "${{ vars.SETTINGS }}" >> ~/${{ env.SOURCE_CODE_PATH }}/stacks/.env
    

